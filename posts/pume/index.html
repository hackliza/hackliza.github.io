<!DOCTYPE html>
<html lang="gl" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>PUME: unha ferramenta para mutar código Python - Hackliza</title>
  <meta name="description" content="Neste artigo explicarase que é e como funciona a ferramenta PUME (Python Universal Mutation Engine), dando tamén algún exemplo de uso para que se vexa ata onde chega.
Introdución PUME é unha ferramenta que modifica aleatoriamente o código fonte dun script ou programa feito en Python sen cambiar a funcionalidade do programa orixinal. Isto conséguese principalmente facendo modificacións sobre a Árbore Sintáctica Abstracta (AST polas súas siglas en inglés) do programa."><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Hackliza",
    
    "url": "https:\/\/hackliza.gal\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/hackliza.gal\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/hackliza.gal\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/hackliza.gal\/posts\/pume\/",
          "name": "P u m e unha ferramenta para mutar código python"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Guzmán Cernadas Pérez"
  },
  "headline": "PUME: unha ferramenta para mutar código Python",
  "description" : "Neste artigo explicarase que é e como funciona a ferramenta PUME (Python Universal Mutation Engine), dando tamén algún exemplo de uso para que se vexa ata onde chega.\nIntrodución PUME é unha ferramenta que modifica aleatoriamente o código fonte dun script ou programa feito en Python sen cambiar a funcionalidade do programa orixinal. Isto conséguese principalmente facendo modificacións sobre a Árbore Sintáctica Abstracta (AST polas súas siglas en inglés) do programa.",
  "inLanguage" : "gl",
  "wordCount":  1372 ,
  "datePublished" : "2023-11-02T00:00:00",
  "dateModified" : "2023-11-02T00:00:00",
  "image" : "https:\/\/hackliza.gal\/img\/hackliza.png",
  "keywords" : [ "python, pume, AST, obfuscation" ],
  "mainEntityOfPage" : "https:\/\/hackliza.gal\/posts\/pume\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/hackliza.gal\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hackliza.gal\/img\/hackliza.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="PUME: unha ferramenta para mutar código Python" />
<meta property="og:description" content="Neste artigo explicarase que é e como funciona a ferramenta PUME (Python Universal Mutation Engine), dando tamén algún exemplo de uso para que se vexa ata onde chega.
Introdución PUME é unha ferramenta que modifica aleatoriamente o código fonte dun script ou programa feito en Python sen cambiar a funcionalidade do programa orixinal. Isto conséguese principalmente facendo modificacións sobre a Árbore Sintáctica Abstracta (AST polas súas siglas en inglés) do programa.">
<meta property="og:image" content="https://hackliza.gal/img/hackliza.png" />
<meta property="og:url" content="https://hackliza.gal/posts/pume/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Hackliza" />

  <meta name="twitter:title" content="PUME: unha ferramenta para mutar código Python" />
  <meta name="twitter:description" content="Neste artigo explicarase que é e como funciona a ferramenta PUME (Python Universal Mutation Engine), dando tamén algún exemplo de uso para que se vexa ata onde chega.
Introdución PUME é unha …">
  <meta name="twitter:image" content="https://hackliza.gal/img/hackliza.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@hackliza" />
  <meta name="twitter:creator" content="@hackliza" />
  <link href='https://hackliza.gal/img/hackliza.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.74.3" />
  <link rel="alternate" href="https://hackliza.gal/index.xml" type="application/rss+xml" title="Hackliza"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://hackliza.gal/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://hackliza.gal/css/syntax.css" /><link rel="stylesheet" href="https://hackliza.gal/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous"><style>
 nav {
     background: #0099CC !important;
 }

 .navbar-brand, #main-navbar ul li a, footer {
     color: #fff !important;
 }

 .navbar-brand:hover, #main-navbar ul li a:hover {
     color: #ccc !important;
 }


 figure {
     margin-top: 1.5em; 
     margin-bottom: 1.5em; 
 }
 
 figcaption {
     text-align: center;
     font-size: 85%;
 }

 pre {
     overflow-x: auto !important;
 }

 .posts-heading {
     text-align: center;
 }
 
</style>



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Conmuta navegación</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://hackliza.gal/">Hackliza</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blogue" href="/">Blogue</a>
            </li>
          
        
          
            <li>
              <a title="Sobre nós" href="/about/">Sobre nós</a>
            </li>
          
        
          
            <li>
              <a title="Charlas" href="/talks/">Charlas</a>
            </li>
          
        

        
          
            <li>
              
                
                  <a href="/en" lang="en">en</a>
                
              
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Hackliza" href="https://hackliza.gal/">
            <img class="avatar-img" src="https://hackliza.gal/img/hackliza.png" alt="Hackliza" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>PUME: unha ferramenta para mutar código Python</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Neste artigo explicarase que é e como funciona a ferramenta
<a href="https://github.com/Caralludo/PUME">PUME (Python Universal Mutation Engine)</a>, dando tamén algún exemplo de uso para
que se vexa ata onde chega.</p>
<h1 id="introdución">Introdución</h1>
<p>PUME é unha ferramenta que modifica aleatoriamente o código fonte dun script ou programa feito en Python sen cambiar
a funcionalidade do programa orixinal. Isto conséguese principalmente facendo modificacións sobre a Árbore Sintáctica
Abstracta (AST polas súas siglas en inglés) do programa. Pero cabe destacar que existe unha modificación que se fai
directamente sobre o código fonte. As modificacións que realizan sobre a AST son:</p>
<ul>
<li>Cambiar os nomes das clases, funcións e variables (tanto locais coma globais).</li>
<li>Cambiar as funcións de posición.</li>
<li>Engadir aleatoriamente a palabra reservada &ldquo;pass&rdquo; no código.</li>
<li>Cambiar números enteiros por unha expresión matemática que teña de resultado o mesmo enteiro que se substituiu.</li>
<li>Cambiar un string por unha suma de strings.</li>
</ul>
<p>A modificación que se realiza directamente sobre o código é a de engadir comentarios monoliña con contido irrelevante
en liñas aleatorias do código. Isto faise desta maneira porque na AST de Python os comentarios non teñen
representación, polo que de base non se poden engadir sobre a AST.</p>
<h1 id="modificacións-sobre-a-ast">Modificacións sobre a AST</h1>
<p>Nesta sección falarase en profundidade das modificacións que PUME é capaz de facer xunto co impacto na AST.</p>
<h2 id="cambio-de-nomes">Cambio de nomes</h2>
<p>Esta funcionalidade consiste en detectar todos os nomes de variables, funcións e clases que se atopen no código fonte e
modificalos sen romper a funcionalidade do programa. Nos seguintes fragmentos de código, móstranse os efectos desta
modificación, o primeiro fragmento é o código orixinal e o segundo é o modificado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Matematicas</span>:
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suma</span>(a, b):
        <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calcula</span>():
    platanos_manuel <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
    platanos_xoan <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
    matematicas <span style="color:#f92672">=</span> Matematicas()
    platanos_totales <span style="color:#f92672">=</span> matematicas<span style="color:#f92672">.</span>suma(platanos_manuel, platanos_xoan)
    <span style="color:#66d9ef">return</span> platanos_totales

calcula()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Alxebra</span>:
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">engade</span>(numero_1, numero_2):
        <span style="color:#66d9ef">return</span> numero_1 <span style="color:#f92672">+</span> numero_2

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">conta</span>():
    uvas_carminha <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
    uvas_dosinda <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
    alxebra <span style="color:#f92672">=</span> Alxebra()
    uvas_finales <span style="color:#f92672">=</span> alxebra<span style="color:#f92672">.</span>engade(uvas_carminha, uvas_dosinda)
    <span style="color:#66d9ef">return</span> uvas_finales

conta()
</code></pre></div><p>Na AST as modificacións fanse sobre os nodos de tipo <a href="https://docs.python.org/3/library/ast.html#ast.Name">ast.Name</a>
cambiando o valor do atributo id. Na seguintes imaxes móstrase o efecto na AST:</p>
<table>
<thead>
<tr>
<th align="center"><img src="./Original_names.png" alt="AST orixinal"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST orixinal</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><img src="./Changed_names.png" alt="AST modificado"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST modificada</td>
</tr>
</tbody>
</table>
<h2 id="cambiar-as-funcións-de-posición">Cambiar as funcións de posición</h2>
<p>Como Python permite chamar a funcións independentemente da súa localización nun ficheiro, entón pódese cambiar as
funcións de posición sen cambiar a funcionalidade do programa. Esta modificación tamén aplica as funcións das clases.
Nos seguintes fragmentos de código, móstranse os efectos desta modificación, o primeiro fragmento é o código orixinal e
o segundo é o modificado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suma</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">resta</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#960050;background-color:#1e0010">–</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">multiplica</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">*</span> b
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">multiplica</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">*</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suma</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">resta</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#960050;background-color:#1e0010">–</span> b
</code></pre></div><p>Na AST as modificacións fanse sobre o atributo body das clases
<a href="https://docs.python.org/3/library/ast.html#ast.Module">ast.Module</a>
e <a href="https://docs.python.org/3/library/ast.html#ast.ClassDef">ast.ClassDef</a> cambiando de posición os nodos de tipo
<a href="https://docs.python.org/3/library/ast.html#ast.FunctionDef">ast.FunctionDef</a>. Nas seguintes imaxes móstrase o efecto
na AST.</p>
<table>
<thead>
<tr>
<th align="center"><img src="./Original_function_position.png" alt="AST orixinal"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST orixinal</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><img src="./Changed_function_position.png" alt="AST modificado"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST modificada</td>
</tr>
</tbody>
</table>
<h2 id="engadir-pass">Engadir &ldquo;pass&rdquo;</h2>
<p>A palabra reservada &ldquo;pass&rdquo; non ten efecto ningún na funcionalidade dun programa, pero na AST de Python ten
representación. Todo isto implica que se pode engadir a palabra arbitrariamente na AST sen consecuencias. Nos seguintes
fragmentos de código, móstranse os efectos desta modificación, o primeiro fragmento é o código orixinal e o segundo é o
modificado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suma</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">resta</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#960050;background-color:#1e0010">–</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">multiplica</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">*</span> b
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">pass</span>
<span style="color:#66d9ef">pass</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">suma</span>(a, b):
    <span style="color:#66d9ef">pass</span>
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">+</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">resta</span>(a, b):
    <span style="color:#66d9ef">return</span> a <span style="color:#960050;background-color:#1e0010">–</span> b

<span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">multiplica</span>(a, b):
    <span style="color:#66d9ef">pass</span>
    <span style="color:#66d9ef">pass</span>
    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">*</span> b
</code></pre></div><p>Na AST as modificacións fanse sobre o atributo body das clases
<a href="https://docs.python.org/3/library/ast.html#ast.Module">ast.Module</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.ClassDef">ast.ClassDef</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.FunctionDef">ast.FunctionDef</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.AsyncFunctionDef">ast.AsyncFunctionDef</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.IfExp">ast.If</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.For">ast.For</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.While">ast.While</a>,
<a href="https://docs.python.org/3/library/ast.html#ast.Try">ast.Try</a> e
<a href="https://docs.python.org/3/library/ast.html#ast.AsyncFor">ast.AsyncFor</a>. Nas seguintes imaxes móstrase o efecto na AST:</p>
<table>
<thead>
<tr>
<th align="center"><img src="./Without_pass.png" alt="AST orixinal"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST orixinal</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><img src="./With_pass.png" alt="AST modificado"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST modificada</td>
</tr>
</tbody>
</table>
<h2 id="cambiar-enteiros">Cambiar enteiros</h2>
<p>Esta funcionalidade consiste en xerar unha expresión matemática a partir dun enteiro. Esta nova expresión matemática
terá coma resultado o mesmo valor ca o enteiro orixinal. Nos seguintes fragmentos de código, móstranse os efectos desta
modificación, o primeiro fragmento é o código orixinal e o segundo é o modificado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">litros_auga <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
consumo <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">litros_auga <span style="color:#f92672">=</span> <span style="color:#ae81ff">35</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">19</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">678</span> <span style="color:#f92672">//</span> <span style="color:#ae81ff">20</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">34</span>
consumo <span style="color:#f92672">=</span> <span style="color:#ae81ff">789</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">231</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">534</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">563</span>
</code></pre></div><p>Na AST o que se consegue é cambiar as clases de tipo
<a href="https://docs.python.org/3/library/ast.html#ast.Constant">ast.Constant</a> con valores que sexan números enteiros por
clases de tipo <a href="https://docs.python.org/3/library/ast.html#ast.BinOp">ast.BinOp</a>. Nas seguintes imaxes móstrase o
efecto na AST:</p>
<table>
<thead>
<tr>
<th align="center"><img src="./Original_integers.png" alt="AST orixinal"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST orixinal</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><img src="./Changed_integers.png" alt="AST modificado"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST modificada</td>
</tr>
</tbody>
</table>
<h2 id="cambiar-strings">Cambiar strings</h2>
<p>Esta funcionalidade consiste en xerar a partir dun string unha suma das súas partes. Nos seguintes fragmentos de
código, móstranse os efectos desta modificación, o primeiro fragmento é o código orixinal e o segundo é o modificado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Adela&#39;</span>
apelidos <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Mazaricos Arzua&#39;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nome <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Ad&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;ela&#39;</span>
apelidos <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Maza&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;ri&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;cos Arz&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;ua&#39;</span>
</code></pre></div><p>Na AST o que se consegue é cambiar as clases de tipo
<a href="https://docs.python.org/3/library/ast.html#ast.Constant">ast.Constant</a> con valores que sexan strings por clases de
tipo <a href="https://docs.python.org/3/library/ast.html#ast.BinOp">ast.BinOp</a>. Nas seguintes imaxes móstrase o efecto na AST:</p>
<table>
<thead>
<tr>
<th align="center"><img src="./Original_strings.png" alt="AST orixinal"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST orixinal</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><img src="./Changed_strings.png" alt="AST modificado"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">AST modificada</td>
</tr>
</tbody>
</table>
<h1 id="outras-funcionalidades">Outras funcionalidades</h1>
<p>A modificación da AST é a parte máis interesante da ferramenta, pero vale a pena mencionar algunhas das funcionalidades
cuxo obxectivo é facilitar o uso da ferramenta:</p>
<ul>
<li><strong>Multificheiro</strong>: A ferramenta accepta a entrada de varios ficheiros ao mesmo tempo e tamén ten en conta se estes
ficheiros importan funcións, variables e clases entre si.</li>
<li><strong>Reparación de enterios e strings</strong>: Esta funcionalidade consiste en, antes de facer os cambios na AST, buscar
expresións matemáticas e sumas de strings para deixalos no seu estado orixinal. Desta forma, evítase un crecemento
desmesurado do resultado final no caso de executar a ferramenta sobre o resultado dunha execución previa.</li>
<li><strong>Borrado de &ldquo;pass&rdquo;</strong>: Antes de engadir a palabra reservada &ldquo;pass&rdquo; no código, búscanse todas as aparicións na AST
e borranse. Desta forma evítase un crecemento desmesurado do código no caso de executar a ferramenta sobre o
resultado dunha execución previa.</li>
</ul>
<h1 id="limitacións">Limitacións</h1>
<p>Aínda que non guste falar do malo da ferramenta, hai que telo en conta para sacarlle o máximo probeito. A continuación,
lístanse as limitacións do programa:</p>
<ul>
<li><a href="https://docs.python.org/3/tutorial/floatingpoint.html#floating-point-arithmetic-issues-and-limitations">Debido a como Python manexa os números reais</a>,
estes non se modifican. Na seguinte imaxe pódese ver unha situación na que unha suma de números reais non da o
resultado correcto.</li>
</ul>
<p><img src="./float_problem.png" alt="Manexo incorrecto de número reais"></p>
<ul>
<li>Debido a que o tipado de Python é dinámico, non se pode saber o tipo de dato dunha variable ata que se execute o
programa. Así que, cando a ferramenta está cambiando os nomes das funcións e dúas clases teñen o mesmo nome para unha
función propia, PUME non sabe a que clase pertence cada función. Debido a isto, <strong>o programador non pode crear dúas
clases con funcións co mesmo nome. Isto tamén aplica as clases da libraría estándar</strong>. No seguinte fragmento de código,
o programador creou unha clase cunha función que ten o mesmo nome ca outra función da libraría estándar. Nesta situación
PUME non pode diferenciar que función é cal:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span>:
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>data <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#e6db74">&#34;d&#34;</span>]
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find</span>(self, a):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>index(a)

my_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;The car is big&#34;</span>
my_string <span style="color:#f92672">=</span> my_string<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;car&#34;</span>)
my_class <span style="color:#f92672">=</span> MyClass()
position <span style="color:#f92672">=</span> my_class<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;a&#34;</span>)
</code></pre></div><p>Para evitar erros na execución da ferramenta, o programador ten que cambiar o nome da función find da clase MyClass,
como se mostra no seguinte fragmento de código.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span>:
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>data <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#e6db74">&#34;d&#34;</span>]
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">search</span>(self, a):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>index(a)

my_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;The car is big&#34;</span>
my_string <span style="color:#f92672">=</span> my_string<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;car&#34;</span>)
my_class <span style="color:#f92672">=</span> MyClass()
position <span style="color:#f92672">=</span> my_class<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#34;a&#34;</span>)
</code></pre></div><h1 id="exemplos">Exemplos</h1>
<p>Finalmente, agora que xa se presentaron as características principais da ferramenta, a continuación veranse algúns
exemplos de uso.</p>
<h2 id="funcionamento-básico">Funcionamento básico</h2>
<p>No seguinte exemplo pódese ver como se executa un programa, como se modifica e como despois das modificacións o
programa segue funcionando:</p>
<p><a href="https://asciinema.org/a/616251"><img src="https://asciinema.org/a/616251.png" alt="asciicast"></a></p>
<h2 id="evasión-dun-antivirus">Evasión dun antivirus</h2>
<p>No seguinte exemplo pódese ver como VirusTotal detecta un ficheiro de <a href="https://github.com/fortra/impacket">Impacket</a>
coma malicioso para despois modificalo e volver a analizalo para ver que xa non o detecta.</p>
<p><a href="https://tube.spdns.org/w/dNr7CSc8UAX8zswrydHtSA"><img src="https://tube.spdns.org/lazy-static/previews/5a2f4447-4a2b-402c-9fee-da428a56270b.jpg" alt="video"></a></p>
<h2 id="creación-dun-virus">Creación dun virus</h2>
<p>Por último, creouse un <a href="https://hackliza.gal/posts/virus_python/">virus</a> chamado
<a href="https://github.com/Caralludo/PUMA">PUMA</a> que utiliza a ferramenta coma motor para mutar o seu propio código.
No seguinte video, mostrase o seu funcionamento:</p>
<p><a href="https://asciinema.org/a/616349"><img src="https://asciinema.org/a/616349.png" alt="asciicast"></a></p>
<h1 id="palabras-finais">Palabras finais</h1>
<p>E isto é todo colegas! Se vos gustou ou vedes como mellorar a ferramenta deixade un comentario ou abride unha issue no
<a href="https://github.com/Caralludo/PUME">repositorio</a>.</p>
<p>Un saudo e ata outra!</p>


        
          <div class="blog-tags">
            
              <a href="https://hackliza.gal//tags/python/">python</a>&nbsp;
            
              <a href="https://hackliza.gal//tags/pume/">pume</a>&nbsp;
            
              <a href="https://hackliza.gal//tags/ast/">AST</a>&nbsp;
            
              <a href="https://hackliza.gal//tags/obfuscation/">obfuscation</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://hackliza.gal/posts/wardriving/" data-toggle="tooltip" data-placement="top" title="Wardriving coa Raspi no 2023">&larr; Artigo anterior</a>
            </li>
          
          
            <li class="next">
              <a href="https://hackliza.gal/posts/stealing_sudo_sessions_with_ptrace/" data-toggle="tooltip" data-placement="top" title="Roubando sesións de sudo con ptrace">Artigo siguiente &rarr;</a>
            </li>
          
        </ul>
      


      
        
          
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hackliza" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
          
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/hackliza" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/hackliza" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://hackliza.gal/">Hackliza</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.74.3</a> alimentada &nbsp;&bull;&nbsp; Tema <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adaptado de <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://hackliza.gal/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://hackliza.gal/js/load-photoswipe.js"></script>








    
  </body>
</html>

